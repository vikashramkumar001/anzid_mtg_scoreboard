<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Master Control</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional Bootstrap 5 JS with Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: "Bebas Neue", sans-serif; /* BebasNeueBold */
        }

        #successMessage {
            color: green;
            display: none; /* Initially hidden */
        }

        #currentHeaderImage {
            width: 300px; /* Set the width for the current image display */
            margin-top: 20px;
            border: 1px solid #ddd;
        }

        #uploadImagePreview {
            display: none;
        }

        #imagePreview {
            width: 300px; /* Set the width of the preview */
            border: 1px solid #ddd;
        }

        #cancelButton {
            display: none; /* Initially hidden */
        }

        #currentFooterImage {
            width: 300px;
            margin-top: 20px;
            border: 1px solid #ddd;
        }

        #uploadFooterImagePreview {
            display: none;
        }

        #footerImagePreview {
            width: 300px;
            border: 1px solid #ddd;
        }

        #cancelFooterButton {
            display: none;
        }

        .custom-dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .custom-dropdown input {
            width: 100%;
            padding: 5px;
        }

        .custom-dropdown .dropdown-list {
            position: absolute;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            background-color: white;
            display: none;
            z-index: 1000;
        }

        .custom-dropdown .dropdown-item {
            padding: 5px;
            cursor: pointer;
        }

        .custom-dropdown .dropdown-item:hover {
            background-color: #f0f0f0;
        }

        .archetype-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .archetype-image-preview {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
        }

        .archetype-name {
            flex-grow: 1;
            margin-right: 10px;
        }

        .archetype-actions {
            display: flex;
            gap: 5px;
        }

        .editable[contenteditable="false"] {
            background-color: #e9ecef; /* Light gray background */
            opacity: 0.7; /* Slight transparency */
            cursor: not-allowed; /* Pointer change to indicate non-editable */
        }

        .editable[contenteditable="true"] {
            background-color: #fff; /* White background when editable */
            opacity: 1; /* Fully opaque */
            cursor: text; /* Text cursor */
        }

        .timer-container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }

        .timer-container .timer-text {
            font-size: 25px;
            margin-right: 25px;
        }

        .timer-container .timer-buttons {
            width: 40px;
            height: 40px;
            margin-left: 2px;
            margin-right: 2px;
        }

        .font-40 {
            font-size: 40px;
        }

    </style>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="container-fluid mt-5">
<div class="container-fluid mt-5">

    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">Master Control</h1>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#overlay-control"
                    type="button" role="tab" aria-controls="home" aria-selected="true">
                Overlays
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="archetype-tab" data-bs-toggle="tab" data-bs-target="#archetype-control"
                    type="button" role="tab" aria-controls="profile" aria-selected="false">
                Archetypes
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="matches-tab" data-bs-toggle="tab" data-bs-target="#match-control" type="button"
                    role="tab" aria-controls="matches" aria-selected="false">
                Matches
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="bracket-tab" data-bs-toggle="tab" data-bs-target="#bracket-control"
                    type="button"
                    role="tab" aria-controls="bracket" aria-selected="false">
                Bracket
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="card-view-tab" data-bs-toggle="tab" data-bs-target="#card-view-control"
                    type="button"
                    role="tab" aria-controls="card-view" aria-selected="false">
                Card View
            </button>
        </li>
    </ul>

    <!-- Tabs Content -->
    <div class="tab-content" id="myTabContent">
        <!-- Overlay Tab Content -->
        <div class="tab-pane fade active show" id="overlay-control" role="tabpanel" aria-labelledby="home-tab">
            <div class="row my-5">
                <div class="col-12">
                    <h2>Overlay Control</h2>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-4">
                    <!-- Current Image Display -->
                    <h3>Current Header Overlay:</h3>
                    <img id="currentHeaderImage" alt="Currently Set Header Image" class="img-fluid mb-4" src=""/>
                </div>
                <div class="col-4">
                    <!-- Upload Header Image Form -->
                    <h3>Upload New Header Overlay:</h3>
                    <form id="uploadForm" enctype="multipart/form-data" class="mb-4">
                        <div class="mb-3">
                            <label for="overlayImage" class="form-label">Upload 1920x100 Header Overlay Image:</label>
                            <input type="file" id="overlayImage" name="overlay" class="form-control" accept="image/*"
                                   required>
                        </div>
                        <button type="submit" class="btn btn-primary">Upload</button>
                        <button type="button" id="cancelButton" class="btn btn-secondary">Cancel Upload</button>
                    </form>
                </div>
                <div class="col-4">
                    <div id="uploadImagePreview" class="mb-4">
                        <h3>Upload Preview:</h3>
                        <!-- Image Preview -->
                        <img id="imagePreview" alt="Image Preview" class="img-fluid" src="">
                    </div>

                    <!-- Success Message Display -->
                    <p id="successMessage" class="alert alert-success"></p>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-4">
                    <!-- Current Footer Image Display -->
                    <h3>Current Footer Overlay:</h3>
                    <img id="currentFooterImage" alt="Currently Set Footer Image" class="img-fluid mb-4" src=""/>
                </div>
                <div class="col-4">
                    <!-- Upload Footer Image Form -->
                    <h3>Upload New Footer Overlay:</h3>
                    <form id="uploadFooterForm" enctype="multipart/form-data" class="mb-4">
                        <div class="mb-3">
                            <label for="overlayFooterImage" class="form-label">Upload 1920x50 Footer Overlay
                                Image:</label>
                            <input type="file" id="overlayFooterImage" name="overlay_footer" class="form-control"
                                   accept="image/*" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Upload</button>
                        <button type="button" id="cancelFooterButton" class="btn btn-secondary">Cancel Upload</button>
                    </form>
                </div>
                <div class="col-4">
                    <div id="uploadFooterImagePreview" class="mb-4">
                        <h3>Upload Preview:</h3>
                        <!-- Footer Image Preview -->
                        <img id="footerImagePreview" alt="Footer Image Preview" class="img-fluid" src="">
                    </div>

                    <!-- Footer Success Message Display -->
                    <p id="footerSuccessMessage" class="alert alert-success" style="display: none;"></p>
                </div>
            </div>
        </div>

        <!-- Archetype Tab Content -->
        <div class="tab-pane fade" id="archetype-control" role="tabpanel" aria-labelledby="archetype-tab">
            <div class="row my-5">
                <div class="col-12">
                    <h2>Archetype List Management</h2>
                </div>
                <div class="col-6">
                    <h3>Current Archetype List</h3>
                    <ul id="archetypeList" class="list-group">
                        <!-- Archetype list items will be dynamically added here -->
                    </ul>
                </div>
                <div class="col-6">
                    <h3>Add New Archetype(s)</h3>
                    <form id="addArchetypeForm" class="mb-3">
                        <div class="form-group">
                    <textarea id="newArchetypeInput" class="form-control" rows="4"
                              placeholder="Enter archetypes name(s) - separate multiple with commas or new lines"
                              required></textarea>
                        </div>
                        <button class="btn btn-primary mt-2" type="submit">Add Archetype(s)</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Matches Tab Content -->
        <div class="tab-pane fade" id="match-control" role="tabpanel" aria-labelledby="matches-tab">
            <div class="row my-5">
                <div class="col-12">
                    <h2>Match Control Center</h2>
                    <hr>
                    <!-- Global -->
                    <div class="row">
                        <div class="col-12 my-3">
                            <h5>Global Settings</h5>
                        </div>
                        <div class="col-6 my-2">
                            Currently Broadcasting: <span id="broadcasting-now-round-display" class="me-3">None</span>
                        </div>
                        <div class="col-6 my-2 text-end">
                            Control 1: <span id="control-1-round-match-display" class="me-3">1-MATCH1</span>
                            Control 2: <span id="control-2-round-match-display" class="me-3">1-MATCH2</span>
                            Control 3: <span id="control-3-round-match-display" class="me-3">1-MATCH3</span>
                            Control 4: <span id="control-4-round-match-display">1-MATCH4</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <h5 class="card-title">Commentators</h5>
                                </div>
                                <div class="col-4">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label class="form-label">Commentator 1</label>
                                                <div id="global-commentator-one" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label class="form-label">Commentator 1 - Subtext</label>
                                                <div id="global-commentator-one-subtext" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label class="form-label">Commentator 2</label>
                                                <div id="global-commentator-two" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label class="form-label">Commentator 2 - Subtext</label>
                                                <div id="global-commentator-two-subtext" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 text-center d-flex flex-center align-items-center justify-content-center">
                                    <button class="btn btn-primary update-button" id="global-update-commentators">
                                        Update
                                    </button>
                                </div>
                            </div>
                            <hr>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="card-title">Event Information</h5>
                                </div>
                                <div class="col-10">
                                    <div class="row">
                                        <div class="col-3">
                                            <div class="mb-3">
                                                <label class="form-label">Event Name</label>
                                                <div id="global-event-name" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="mb-3">
                                                <label class="form-label">Event Format</label>
                                                <div id="global-event-format" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="mb-3">
                                                <label class="form-label">Miscellaneous Details</label>
                                                <div id="global-event-miscellaneous-details"
                                                     class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="mb-3">
                                                <label class="form-label">
                                                    Base LifePoints (<span
                                                        id="global-event-base-life-points-current"></span>)
                                                </label>
                                                <div id="global-event-base-life-points" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="mb-3">
                                                <label class="form-label">
                                                    Base Timer (<span
                                                        id="global-event-base-timer-current"></span>)
                                                </label>
                                                <div id="global-event-base-timer" class="editable form-control"
                                                     contenteditable="true"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-2 text-center d-flex flex-center align-items-center justify-content-center">
                                    <button class="btn btn-primary update-button" id="global-update-event-information">
                                        Update
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <!-- Rounds Details -->
                    <div class="row">
                        <div class="col-12 my-3">
                            <h5>Round Details</h5>
                        </div>
                    </div>
                    <!-- Add Round Tabs Navigation -->
                    <ul class="nav nav-tabs" id="roundTabs" role="tablist">
                        <!-- Round tabs will be dynamically inserted here -->
                    </ul>

                    <!-- Add Round Tabs Content -->
                    <div class="tab-content" id="roundTabsContent">
                        <!-- Round content will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Bracket Tab Content -->
        <div class="tab-pane fade" id="bracket-control" role="tabpanel" aria-labelledby="bracket-tab">
            <div class="row my-3">
                <div class="col-12">
                    <h5>QuarterFinals</h5>
                </div>
            </div>
            <div class="row my-3">
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-1-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-1-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-1-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-1-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-1-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-2-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-2-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-2-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-2-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-2-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-3-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-3-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-3-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-3-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-3-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-4-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-4-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-4-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-4-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-4-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-5-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-5-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-5-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-5-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-5-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-6-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-6-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-6-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-6-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-6-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-7-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-7-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-7-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-7-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-7-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-quarterfinal-8-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-quarterfinal-8-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-quarterfinal-8-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-quarterfinal-8-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-quarterfinal-8-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row my-3">
                <div class="col-12">
                    <h5>SemiFinals</h5>
                </div>
            </div>
            <div class="row my-3">
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-semifinal-1-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-semifinal-1-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-semifinal-1-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-semifinal-1-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-semifinal-1-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-semifinal-2-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-semifinal-2-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-semifinal-2-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-semifinal-2-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-semifinal-2-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-semifinal-3-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-semifinal-3-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-semifinal-3-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-semifinal-3-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-semifinal-3-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-semifinal-4-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-semifinal-4-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-semifinal-4-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-semifinal-4-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-semifinal-4-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row my-3">
                <div class="col-12">
                    <h5>Final</h5>
                </div>
            </div>
            <div class="row my-3">
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-final-1-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-final-1-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-final-1-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-final-1-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-final-1-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div id="bracket-final-2-name" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Archetype</label>
                                        <div id="bracket-final-2-archetype" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Rank</label>
                                        <div id="bracket-final-2-rank" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Points</label>
                                        <div id="bracket-final-2-points" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <div class="mb-3">
                                        <label class="form-label">Win</label>
                                        <div id="bracket-final-2-win" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row my-3">
                <div class="col-12 text-center d-flex flex-center align-items-center justify-content-center">
                    <button class="btn btn-primary update-button" id="bracket-update-button">
                        Update
                    </button>
                </div>
            </div>
        </div>

        <!-- Card View Tab Content -->
        <div class="tab-pane fade" id="card-view-control" role="tabpanel" aria-labelledby="card-view-tab">
            <div class="row my-3">
                <div class="col-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="row my-3">
                                <div class="col-12">
                                    <h5>Dedicated Card View</h5>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-8">
                                    <div class="mb-3">
                                        <label class="form-label">Card Select</label>
                                        <div id="card-view-card-autocomplete" class="editable form-control"
                                             contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4 text-center d-flex flex-center align-items-center justify-content-center">
                                    <button class="btn btn-primary update-button" id="card-view-display-button">
                                        View Card
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<template id="custom-dropdown-template">
    <div class="custom-dropdown">
        <input type="text" class="form-control">
        <div class="dropdown-list"></div>
    </div>
</template>

<script>
    const socket = io();
    const currentHeaderImage = document.getElementById('currentHeaderImage');
    const preview = document.getElementById('imagePreview'); // Get the preview element
    const previewContainer = document.getElementById('uploadImagePreview'); // Get the preview element
    const successMessage = document.getElementById('successMessage');
    const cancelButton = document.getElementById('cancelButton');
    const overlayHeaderImage = document.getElementById('overlayImage');
    const matchContainer = document.getElementById('matchControlCenter');
    const broadcastDisplay = document.getElementById('broadcasting-now-round-display');
    const control1Display = document.getElementById('control-1-round-match-display');
    const control2Display = document.getElementById('control-2-round-match-display');
    const control3Display = document.getElementById('control-3-round-match-display');
    const control4Display = document.getElementById('control-4-round-match-display');
    const updateEventInformation = document.querySelector(`#global-update-event-information.update-button`);
    const updateCommentators = document.querySelector(`#global-update-commentators.update-button`);
    const commentator1 = document.querySelector(`#global-commentator-one`);
    const commentator1_subtext = document.querySelector(`#global-commentator-one-subtext`);
    const commentator2 = document.querySelector(`#global-commentator-two`);
    const commentator2_subtext = document.querySelector(`#global-commentator-two-subtext`);
    const matchEventName = document.querySelector(`#global-event-name`);
    const matchEventFormat = document.querySelector(`#global-event-format`);
    const matchEventMiscDetails = document.querySelector(`#global-event-miscellaneous-details`);
    const matchEventBaseLifePoints = document.querySelector(`#global-event-base-life-points`);
    const matchEventBaseLifePointsCurrent = document.querySelector(`#global-event-base-life-points-current`);
    const matchEventBaseTimer = document.querySelector(`#global-event-base-timer`);
    const matchEventBaseTimerCurrent = document.querySelector(`#global-event-base-timer-current`);
    const cardViewViewCardButton = document.querySelector('#card-view-display-button');
    let allControlData = {};
    let allTimerStates = {};
    let allStandingsData = {};
    let bracketData = {};
    let baseLifePoints = '20';
    let baseTimer = '50';
    let cardListData = [];

    // Handle the form submission via JavaScript (AJAX)
    const form = document.getElementById('uploadForm');
    form.addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the form from submitting the traditional way

        // Create a FormData object to hold the file input data
        const formData = new FormData();
        formData.append('overlay_header', overlayHeaderImage.files[0]);

        // Submit the form via fetch (AJAX)
        fetch('/upload-header-overlay', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Image uploaded successfully!');
                    successMessage.textContent = 'Image uploaded successfully';
                    successMessage.style.display = 'block'; // Display the success message

                    // Update the currently set image
                    const cacheBuster = new Date().getTime(); // Get the current timestamp
                    currentHeaderImage.src = data.newImageUrl + '?v=' + cacheBuster; // Set the src to the new image URL
                    currentHeaderImage.style.display = 'block'; // Display the image

                    // stop showing preview container
                    previewContainer.style.display = 'none';

                    // stop showing cancel button
                    cancelButton.style.display = 'none';

                    // Clear the file input
                    overlayImage.value = '';
                } else {
                    console.error('Upload failed');
                }
            })
            .catch(error => {
                console.error('Error uploading image:', error);
            });
    });

    // Image preview functionality
    overlayHeaderImage.addEventListener('change', function (event) {
        const file = event.target.files[0]; // Get the selected file
        const reader = new FileReader();

        if (file) {
            reader.readAsDataURL(file); // Read the file as a data URL (base64)

            reader.onload = function (e) {
                // show cancel button
                cancelButton.style.display = 'inline';
                // remove message if exists
                successMessage.style.display = 'none';
                // Set the src of the preview image
                preview.src = e.target.result;
                // Display the preview image
                previewContainer.style.display = 'block';
            };
        }
    });

    // Cancel upload functionality
    cancelButton.addEventListener('click', function () {
        // Clear the file input
        overlayImage.value = '';
        // Hide the preview image and cancel button
        previewContainer.style.display = 'none';
        cancelButton.style.display = 'none';
    });

    // Function to render or update a match card
    function renderMatch(roundId, matchId, matchData) {
        // Check if a card for this match already exists
        let matchContainer = document.getElementById(`round-${roundId}-matches`);
        let matchCard = document.getElementById(`match-card-${roundId}-${matchId}`);

        if (!matchCard) {
            // Create new card (use your existing card HTML structure)
            matchCard = document.createElement('div');
            matchCard.classList.add('col-6', 'mb-3', 'match-card-container');
            matchCard.id = `match-card-${roundId}-${matchId}`;
            matchCard.innerHTML = `
            <div class="row mb-2">
                <div class="col-3 d-flex flex-row justify-content-start align-items-center">
                    <h3 class="match-id-name mb-0">${roundId}-${matchId}</h3>
                </div>
                <div class="col-9 d-flex flex-row justify-content-end">
                    <button id="reset-life-${roundId}-${matchId}" class="btn btn-warning reset-life-button me-2" data-match-id="${matchId}"
                            data-round-id="${roundId}">Reset Life
                    </button>
                    <button id="control-1-${roundId}-${matchId}" class="btn btn-secondary control-button me-2" data-match-id="${matchId}"
                            data-round-id="${roundId}" data-control-id="1">Control 1
                    </button>
                    <button id="control-2-${roundId}-${matchId}" class="btn btn-secondary control-button me-2" data-match-id="${matchId}"
                            data-round-id="${roundId}" data-control-id="2">Control 2
                    </button>
                    <button id="control-3-${roundId}-${matchId}" class="btn btn-secondary control-button me-2" data-match-id="${matchId}"
                            data-round-id="${roundId}" data-control-id="3">Control 3
                    </button>
                    <button id="control-4-${roundId}-${matchId}" class="btn btn-secondary control-button" data-match-id="${matchId}"
                            data-round-id="${roundId}" data-control-id="4">Control 4
                    </button>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="row mb-4">
                        <!-- Event Information -->
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">
                                    <div class="timer-container">
                                        <div id="timer-${roundId}-${matchId}" class="timer-text">50:00</div>
                                        <button id="timer-add-${roundId}-${matchId}" class="btn timer-button font-40" >+</button>
                                        <button id="timer-minus-${roundId}-${matchId}" class="btn timer-button font-40" >-</button>
                                        <button id="timer-start-${roundId}-${matchId}" class="btn timer-button"></button>
                                        <button id="timer-pause-${roundId}-${matchId}" class="btn timer-button"></button>
                                        <button id="timer-reset-${roundId}-${matchId}" class="btn timer-button"></button>
                                    </div>
                                </div>
                                <div class="col-12 text-center">
                                    <label>
                                        <input type="checkbox" id="timer-display-scoreboard-${roundId}-${matchId}"> Show Timer on Scoreboard
                                    </label>
                                </div>
                                <div class="col-12">
                                    <h5 class="card-title">Event Information</h5>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Event Name</label>
                                        <div id="${roundId}-${matchId}-event-name" class="editable form-control" contenteditable="false"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Event Round</label>
                                        <div id="${roundId}-${matchId}-event-round" class="editable form-control" contenteditable="true"></div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label class="form-label">Event Format</label>
                                        <div id="${roundId}-${matchId}-event-format" class="editable form-control" contenteditable="false"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <!-- Left Player Information -->
                        <div class="col-md-6">
                            <h5 class="card-title">Left Player</h5>
                            <div class="mb-3">
                                <label class="form-label">Player Name</label>
                                <div id="${roundId}-${matchId}-player-name-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">LifePoints</label>
                                <div id="${roundId}-${matchId}-player-life-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pronouns</label>
                                <div id="${roundId}-${matchId}-player-pronouns-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Archetype</label>
                                <div id="${roundId}-${matchId}-player-archetype-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Record</label>
                                <div id="${roundId}-${matchId}-player-record-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Wins</label>
                                <div id="${roundId}-${matchId}-player-wins-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Poison</label>
                                <div id="${roundId}-${matchId}-player-poison-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Mulligan</label>
                                <div id="${roundId}-${matchId}-player-mulligan-left" class="editable form-control" contenteditable="true"></div>
                            </div>
                        </div>

                        <!-- Right Player Information -->
                        <div class="col-md-6">
                            <h5 class="card-title">Right Player</h5>
                            <div class="mb-3">
                                <label class="form-label">Player Name</label>
                                <div id="${roundId}-${matchId}-player-name-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">LifePoints</label>
                                <div id="${roundId}-${matchId}-player-life-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pronouns</label>
                                <div id="${roundId}-${matchId}-player-pronouns-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Archetype</label>
                                <div id="${roundId}-${matchId}-player-archetype-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Record</label>
                                <div id="${roundId}-${matchId}-player-record-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Wins</label>
                                <div id="${roundId}-${matchId}-player-wins-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Poison</label>
                                <div id="${roundId}-${matchId}-player-poison-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Mulligan</label>
                                <div id="${roundId}-${matchId}-player-mulligan-right" class="editable form-control" contenteditable="true"></div>
                            </div>
                        </div>
                    </div>

                    <!-- New row for deck information -->
                    <div class="row">
                        <!-- Left Player Deck Information -->
                        <div class="col-md-6">
                            <h5 class="card-title">Left Player Deck</h5>
                            <div class="mb-3">
                                <label class="form-label">Main Deck</label>
                                <textarea id="${roundId}-${matchId}-player-main-deck-left" 
                                        class="editable form-control" 
                                        rows="5" 
                                        placeholder="Enter main deck cards (separated by commas or new lines)"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Side Deck</label>
                                <textarea id="${roundId}-${matchId}-player-side-deck-left" 
                                        class="editable form-control" 
                                        rows="3" 
                                        placeholder="Enter side deck cards (separated by commas or new lines)"></textarea>
                            </div>
                            <div class="my-3">
                                <button class="btn btn-primary" id="display-deck-left-${roundId}-${matchId}">Display Deck</button>
                            </div>
                        </div>
                        <!-- Right Player Deck Information -->
                        <div class="col-md-6">
                            <h5 class="card-title">Right Player Deck</h5>
                            <div class="mb-3">
                                <label class="form-label">Main Deck</label>
                                <textarea id="${roundId}-${matchId}-player-main-deck-right" 
                                        class="editable form-control" 
                                        rows="5" 
                                        placeholder="Enter main deck cards (separated by new lines)"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Side Deck</label>
                                <textarea id="${roundId}-${matchId}-player-side-deck-right" 
                                        class="editable form-control" 
                                        rows="3" 
                                        placeholder="Enter side deck cards (separated by new lines)"></textarea>
                            </div>
                            <div class="my-3">
                                <button class="btn btn-primary" id="display-deck-right-${roundId}-${matchId}">Display Deck</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        `;
            // Add the new card to the round's match container
            matchContainer.appendChild(matchCard);
            // Attach change listeners
            attachChangeListeners(roundId, matchId);
            // Attach the deck display listeners after rendering
            attachDeckDisplayListeners(roundId, matchId);
            // Attach control mapping listeners
            attachControlMappingButtonListeners(roundId, matchId);
            // Attach reset life listener
            attachMatchResetLifeButtonListeners(roundId, matchId);
            // Attach timer listeners
            attachMatchTimerButtonListeners(roundId, matchId);
        }

        // Update the fields with the match data
        Object.keys(matchData).forEach(key => {
            const fieldElement = document.getElementById(`${roundId}-${matchId}-${key}`);
            if (fieldElement) {
                if (fieldElement.tagName.toLowerCase() === 'textarea') {
                    if (key.includes('main-deck') || key.includes('side-deck')) {
                        // Join array elements with newlines for deck lists
                        fieldElement.value = Array.isArray(matchData[key])
                            ? matchData[key].join('\n')
                            : matchData[key];
                    } else {
                        fieldElement.value = matchData[key];
                    }
                } else {
                    fieldElement.textContent = matchData[key];
                }
            }
        });
    }

    // Function to attach change listeners to all editable fields for a given match ID
    function attachChangeListeners(roundId, matchId) {
        const editableFields = document.querySelectorAll(`#match-card-${roundId}-${matchId} .editable`);
        editableFields.forEach(field => {
            field.addEventListener('input', () => {
                let value;

                // Handle deck lists as arrays
                if (field.tagName.toLowerCase() === 'textarea' &&
                    (field.id.includes('main-deck') || field.id.includes('side-deck'))) {
                    // Split by newlines and/or commas, trim whitespace, and filter empty strings
                    value = field.value
                        .split(/\n+/)
                        .map(card => card.trim())
                        .filter(card => card !== '');
                } else {
                    // Handle other fields normally
                    value = field.tagName.toLowerCase() === 'textarea' ? field.value : field.textContent;
                }

                // check if event round is being updated
                if (field.id.includes('event-round')) {
                    // Dynamically select all event-round fields for this round and matches
                    const eventFields = document.querySelectorAll(`[id^="${roundId}-match"][id$="-event-round"]`);
                    eventFields.forEach(eventField => {
                        // Avoid updating the field currently being edited
                        if (eventField !== field) {
                            eventField.innerText = value;
                        }
                    });
                    // Update control data for all matches in this round
                    Object.keys(allControlData[roundId]).forEach(matchId => {
                        allControlData[roundId][matchId]['event-round'] = value;
                    });
                }

                // Update the local control data when a field changes
                updateControlData(roundId, matchId, field.id.replace(`${roundId}-${matchId}-`, ''), value);
                // Emit the updated control data to the backend
                console.log('updated all data', allControlData);
                socket.emit('master-control-matches-updated', allControlData);
            });
        });
    }

    // Function to update the control data for a specific match
    function updateControlData(roundId, matchId, key, value) {
        if (!allControlData[roundId]) {
            allControlData[roundId] = {};
        }
        if (!allControlData[roundId][matchId]) {
            allControlData[roundId][matchId] = {};
        }
        console.log(roundId, matchId, key, value)
        allControlData[roundId][matchId][key] = value;
    }

    // Function to remove match cards that no longer exist
    function removeStaleMatches(activeMatchIds) {
        // Get all existing match cards in the DOM
        const matchCards = matchContainer.querySelectorAll('.match-card-container');
        console.log(matchCards)
        matchCards.forEach(card => {
            const matchId = card.id.replace('match-card-', '');
            // If the matchId is not in the activeMatchIds, remove the card
            if (!activeMatchIds.has(matchId)) {
                card.remove();
                console.log(`Removed match card for matchId: ${matchId}`);
            }
        });
    }

    // Listen for background image update
    socket.on('overlayHeaderBackgroundUpdate', (newImageUrl) => {
        console.log('Overlay header background image:', newImageUrl);

        // Update the currently set image
        currentHeaderImage.src = newImageUrl; // Set the src to the new image URL
        currentHeaderImage.style.display = 'block'; // Display the image
    });

    // Listen for background image update
    socket.on('overlayHeaderBackgroundUpdate', (newImageUrl) => {
        console.log('Overlay header background image:', newImageUrl);

        // Update the currently set image
        currentHeaderImage.src = newImageUrl; // Set the src to the new image URL
        currentHeaderImage.style.display = 'block'; // Display the image
    });

    // Listen for any updates to full control data to update the page
    socket.on('control-data-updated', (allData) => {
        console.log('Control data was updated', allData);
        // save to local object
        allControlData = allData;

        // Render the round tabs
        renderRoundTabs(allData);

        // Set up custom dropdowns after rendering
        setupCustomDropdowns();
    });

    const currentFooterImage = document.getElementById('currentFooterImage');
    const footerPreview = document.getElementById('footerImagePreview');
    const footerPreviewContainer = document.getElementById('uploadFooterImagePreview');
    const footerSuccessMessage = document.getElementById('footerSuccessMessage');
    const cancelFooterButton = document.getElementById('cancelFooterButton');
    const overlayFooterImage = document.getElementById('overlayFooterImage');

    // Handle the footer form submission
    const footerForm = document.getElementById('uploadFooterForm');
    footerForm.addEventListener('submit', function (event) {
        event.preventDefault();

        const formData = new FormData();
        formData.append('overlay_footer', overlayFooterImage.files[0]);

        fetch('/upload-footer-overlay', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Footer image uploaded successfully!');
                    footerSuccessMessage.textContent = 'Footer image uploaded successfully';
                    footerSuccessMessage.style.display = 'block';

                    const cacheBuster = new Date().getTime();
                    currentFooterImage.src = data.newImageUrl + '?v=' + cacheBuster;
                    currentFooterImage.style.display = 'block';

                    footerPreviewContainer.style.display = 'none';
                    cancelFooterButton.style.display = 'none';
                    overlayFooterImage.value = '';
                } else {
                    console.error('Footer upload failed');
                }
            })
            .catch(error => {
                console.error('Error uploading footer image:', error);
            });
    });

    // Footer image preview functionality
    overlayFooterImage.addEventListener('change', function (event) {
        const file = event.target.files[0];
        const reader = new FileReader();

        if (file) {
            reader.readAsDataURL(file);

            reader.onload = function (e) {
                cancelFooterButton.style.display = 'inline';
                footerSuccessMessage.style.display = 'none';
                footerPreview.src = e.target.result;
                footerPreviewContainer.style.display = 'block';
            };
        }
    });

    // Cancel footer upload functionality
    cancelFooterButton.addEventListener('click', function () {
        overlayFooterImage.value = '';
        footerPreviewContainer.style.display = 'none';
        cancelFooterButton.style.display = 'none';
    });

    // Listen for footer background image update
    socket.on('overlayFooterBackgroundUpdate', (newImageUrl) => {
        console.log('Overlay footer background image:', newImageUrl);
        currentFooterImage.src = newImageUrl;
        currentFooterImage.style.display = 'block';
    });

    // Archetype list management
    const archetypeList = document.getElementById('archetypeList');
    const addArchetypeForm = document.getElementById('addArchetypeForm');
    const newArchetypeInput = document.getElementById('newArchetypeInput');

    // Function to render the archetype list
    function renderArchetypeList(archetypes) {
        archetypeList.innerHTML = '';
        archetypes.forEach(archetype => {
            const li = document.createElement('li');
            li.className = 'list-group-item archetype-item';

            if (archetype.imageUrl) {
                const img = document.createElement('img');
                const cacheBuster = new Date().getTime();
                img.className = 'archetype-image-preview';
                img.src = archetype.imageUrl + '?v=' + cacheBuster;
                img.alt = archetype.name;
                li.appendChild(img);
            }

            const nameSpan = document.createElement('span');
            nameSpan.className = 'archetype-name';
            nameSpan.textContent = archetype.name;

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'archetype-actions';

            const uploadLabel = document.createElement('label');
            uploadLabel.className = 'btn btn-secondary btn-sm';
            uploadLabel.textContent = archetype.imageUrl ? 'Change Image' : 'Upload Image';

            const uploadInput = document.createElement('input');
            uploadInput.type = 'file';
            uploadInput.accept = 'image/*';
            uploadInput.style.display = 'none';
            uploadInput.addEventListener('change', (e) => uploadArchetypeImage(archetype.name, e.target.files[0]));

            uploadLabel.appendChild(uploadInput);

            const deleteButton = document.createElement('button');
            deleteButton.className = 'btn btn-danger btn-sm';
            deleteButton.textContent = 'Delete';
            deleteButton.onclick = () => deleteArchetype(archetype.name);

            actionsDiv.appendChild(uploadLabel);
            actionsDiv.appendChild(deleteButton);

            li.appendChild(nameSpan);
            li.appendChild(actionsDiv);

            archetypeList.appendChild(li);
        });
    }

    function uploadArchetypeImage(archetypeName, file) {
        const formData = new FormData();
        formData.append('archetypeName', archetypeName);
        formData.append('image', file);

        fetch('/upload-archetype-image', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Image uploaded successfully');
                    socket.emit('getArchetypeList');
                } else {
                    console.error('Failed to upload image:', data.message);
                    alert('Failed to upload image: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error uploading image:', error);
                alert('Error uploading image. Please try again.');
            });
    }

    // Function to add a new archetype
    function addArchetype(archetypeName) {
        socket.emit('addArchetype', archetypeName);
    }

    // Function to delete a archetype
    function deleteArchetype(archetypeName) {
        socket.emit('deleteArchetype', archetypeName);
    }

    // Function to add new archetypes
    function addArchetypes(archetypeNames) {
        // Filter out any archetype names that already exist in the current list
        const newArchetypeNames = archetypeNames.filter(name => !currentArchetypeList.includes(name));
        if (newArchetypeNames.length > 0) {
            socket.emit('addArchetypes', newArchetypeNames);
        }
    }

    let currentArchetypeList = []; // Keep track of the current archetype list

    // Handle form submission for adding new archetypes
    addArchetypeForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const input = newArchetypeInput.value.trim();
        if (input) {
            // Split input by commas or newlines, then trim each entry and filter out empty strings and duplicates
            const archetypeNames = [...new Set(input.split(/[,\n]+/).map(name => name.trim()).filter(name => name !== ''))];
            addArchetypes(archetypeNames);
            newArchetypeInput.value = '';
        }
    });

    // Listen for updated archetype list from server
    socket.on('archetypeListUpdated', (archetypes) => {
        currentArchetypeList = archetypes; // Update the current archetype list
        renderArchetypeList(archetypes);
    });

    // Request initial archetype list when page loads
    socket.emit('getArchetypeList');

    // Function to initialize the archetype list
    function initializeArchetypeList() {
        socket.emit('getArchetypeList');
    }

    // Listen for updated archetype list from server
    socket.on('archetypeListUpdated', (archetypes) => {
        console.log(archetypes)
        currentArchetypeList = archetypes; // Update the current archetype list
        renderArchetypeList(archetypes);
    });

    // Initialize the archetype list when the page loads
    initializeArchetypeList();

    function renderDropdownList(dropdownList, items, field) {
        dropdownList.innerHTML = '';
        items.forEach(item => {
            const div = document.createElement('div');
            div.textContent = item.name;
            div.classList.add('dropdown-item');
            div.addEventListener('click', function () {
                field.textContent = item.name;
                dropdownList.style.display = 'none';
                field.dispatchEvent(new Event('input'));
                field.dispatchEvent(new Event('change')); // Trigger change event
            });
            dropdownList.appendChild(div);
        });
        dropdownList.style.display = items.length > 0 ? 'block' : 'none';
    }

    function setupCustomDropdowns() {
        const archetypeFields = document.querySelectorAll('[id$="-player-archetype-left"], [id$="-player-archetype-right"], [id^="bracket-"][id$="-archetype"]');

        archetypeFields.forEach(field => {
            if (field.parentNode.classList.contains('custom-dropdown')) {
                return; // Skip if already set up
            }

            const wrapper = document.createElement('div');
            wrapper.className = 'custom-dropdown';
            field.parentNode.insertBefore(wrapper, field);
            wrapper.appendChild(field);

            const dropdownList = document.createElement('div');
            dropdownList.className = 'dropdown-list';
            wrapper.appendChild(dropdownList);

            field.addEventListener('input', function () {
                const value = this.textContent.trim().toLowerCase();
                const filteredArchetypes = currentArchetypeList.filter(archetype => archetype.name.toLowerCase().includes(value))
                    .slice(0, 5); // Limit to top 5 results
                renderDropdownList(dropdownList, filteredArchetypes, field);
            });

            field.addEventListener('focus', function () {
                renderDropdownList(dropdownList, currentArchetypeList, field);
            });

            document.addEventListener('click', function (e) {
                if (!wrapper.contains(e.target)) {
                    dropdownList.style.display = 'none';
                }
            });
        });
    }

    // Initial setup when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        setupCustomDropdowns();
    });

    // Add these functions to your existing script section
    function renderRoundTabs(allData) {
        const roundTabs = document.getElementById('roundTabs');
        const roundContent = document.getElementById('roundTabsContent');

        if (roundTabs.children.length === 0 && roundContent.children.length === 0) {
            // Create tabs and content for each round
            Object.keys(allData).forEach((roundId, index) => {
                // Create tab
                const tab = document.createElement('li');
                tab.className = 'nav-item';
                tab.innerHTML = `
                <button class="nav-link ${index === 0 ? 'active' : ''}"
                        id="round-${roundId}-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#round-${roundId}-content"
                        type="button"
                        role="tab"
                        aria-controls="round-${roundId}"
                        aria-selected="${index === 0}">
                    Round ${roundId}
                </button>
            `;
                roundTabs.appendChild(tab);

                // Create content
                const content = document.createElement('div');
                content.className = `tab-pane fade ${index === 0 ? 'show active' : ''}`;
                content.id = `round-${roundId}-content`;
                content.role = 'tabpanel';
                content.setAttribute('aria-labelledby', `round-${roundId}-tab`);

                // create container for round actions
                const roundActions = document.createElement('div');
                roundActions.className = 'col-12 d-flex flex-row justify-content-center my-3';
                roundActions.innerHTML = `<button class="btn btn-primary broadcast-button" id="broadcast-${roundId}" data-round-id="${roundId}">Broadcast</button>`;
                content.appendChild(roundActions);

                const divider = document.createElement('hr');
                content.appendChild(divider);

                // Create container for match cards
                const matchContainer = document.createElement('div');
                matchContainer.id = `round-${roundId}-matches`;
                matchContainer.className = 'mt-3 row';
                content.appendChild(matchContainer);

                roundContent.appendChild(content);

                attachBroadcastButtonListeners(roundId);

            });
        }

        // update content in round / matches
        Object.keys(allData).forEach((roundId, index) => {
            // Render all matches for this round
            Object.entries(allData[roundId]).forEach(([matchId, matchData]) => {
                renderMatch(roundId, matchId, matchData);
            });
        })

        // matches are rendered - now ask server for standings
        socket.emit('get-all-standings');
    }

    // Add click handlers for the Display Deck buttons
    function attachDeckDisplayListeners(round_id, match_id) {
        const leftDeckButton = document.querySelector(`#display-deck-left-${round_id}-${match_id}`);
        const rightDeckButton = document.querySelector(`#display-deck-right-${round_id}-${match_id}`);

        leftDeckButton.addEventListener('click', () => {
            socket.emit('display-deck', {
                round_id,
                match_id,
                side: 'left'
            });
        });

        rightDeckButton.addEventListener('click', () => {
            socket.emit('display-deck', {
                round_id,
                match_id,
                side: 'right'
            });
        });
    }

    // add event listeners for broadcast buttons
    function attachBroadcastButtonListeners(round_id) {
        const broadcast = document.querySelector(`#broadcast-${round_id}`);
        broadcast.addEventListener('click', () => {
            console.log(`broadcast clicked for round ${round_id}`);
            broadcastDisplay.innerText = `Round ${round_id}`;
            socket.emit('broadcast-requested', {
                round_id
            });
        });
    }

    // Add event listeners for control buttons
    function attachControlMappingButtonListeners(round_id, match_id) {
        const control1 = document.querySelector(`#control-1-${round_id}-${match_id}.control-button`);
        const control2 = document.querySelector(`#control-2-${round_id}-${match_id}.control-button`);
        const control3 = document.querySelector(`#control-3-${round_id}-${match_id}.control-button`);
        const control4 = document.querySelector(`#control-4-${round_id}-${match_id}.control-button`);
        control1.addEventListener('click', () => {
            console.log('click from', round_id, match_id);
            control1Display.innerText = `${round_id}-${match_id}`;
            socket.emit('control-mapping-update', {controlId: '1', round_id, match_id});
        })
        control2.addEventListener('click', () => {
            console.log('click from', round_id, match_id);
            control2Display.innerText = `${round_id}-${match_id}`;
            socket.emit('control-mapping-update', {controlId: '2', round_id, match_id});
        })
        control3.addEventListener('click', () => {
            console.log('click from', round_id, match_id);
            control3Display.innerText = `${round_id}-${match_id}`;
            socket.emit('control-mapping-update', {controlId: '3', round_id, match_id});
        })
        control4.addEventListener('click', () => {
            console.log('click from', round_id, match_id);
            control4Display.innerText = `${round_id}-${match_id}`;
            socket.emit('control-mapping-update', {controlId: '4', round_id, match_id});
        })
    }

    // Add event listeners for reset life buttons
    function attachMatchResetLifeButtonListeners(round_id, match_id) {
        const resetLifeButton = document.querySelector(`#reset-life-${round_id}-${match_id}.reset-life-button`);
        resetLifeButton.addEventListener('click', () => {
            console.log('click reset life', round_id, match_id);
            // update life points for left and right of round / match
            document.querySelector(`[id="${round_id}-${match_id}-player-life-left"]`).innerText = baseLifePoints;
            document.querySelector(`[id="${round_id}-${match_id}-player-life-right"]`).innerText = baseLifePoints;
            // update controlData
            allControlData[round_id][match_id]['player-life-left'] = baseLifePoints;
            allControlData[round_id][match_id]['player-life-right'] = baseLifePoints;
            // update server since control data changed
            socket.emit('master-control-matches-updated', allControlData);
        })
    }

    // get control and broadcast trackers
    socket.emit('get-control-broadcast-trackers');

    socket.on('control-broadcast-trackers', (data) => {
        console.log('control and broadcast tracking update', data);
        // update broadcast and control displays
        broadcastDisplay.innerText = data['broadcastTracker']['round_id'] ? `Round ${data['broadcastTracker']['round_id']}` : 'None';
        control1Display.innerText = `${data['controlsTracker']['1']['round_id']}-${data['controlsTracker']['1']['match_id']}`;
        control2Display.innerText = `${data['controlsTracker']['2']['round_id']}-${data['controlsTracker']['2']['match_id']}`;
        control3Display.innerText = `${data['controlsTracker']['3']['round_id']}-${data['controlsTracker']['3']['match_id']}`;
        control4Display.innerText = `${data['controlsTracker']['4']['round_id']}-${data['controlsTracker']['4']['match_id']}`;
    })

    // add click handlers for update global buttons
    function attachGlobalCommentatorsListener() {
        updateCommentators.addEventListener('click', () => {
            const data2send = {
                'global-commentator-one': commentator1.innerText,
                'global-commentator-one-subtext': commentator1_subtext.innerText,
                'global-commentator-two': commentator2.innerText,
                'global-commentator-two-subtext': commentator2_subtext.innerText
            }
            console.log(data2send)
            socket.emit('update-commentators-requested', {commentatorData: data2send});
        })
    }

    // attach on startup
    attachGlobalCommentatorsListener();

    // call for global data at start up
    socket.emit('get-match-global-data');

    // handle response for global data
    socket.on('update-match-global-data', (data) => {
        // update match global fields
        console.log('got global data', data['globalData'])
        commentator1.innerText = data['globalData']['global-commentator-one'] ? data['globalData']['global-commentator-one'] : '';
        commentator1_subtext.innerText = data['globalData']['global-commentator-one-subtext'] ? data['globalData']['global-commentator-one-subtext'] : '';
        commentator2.innerText = data['globalData']['global-commentator-two'] ? data['globalData']['global-commentator-two'] : '';
        commentator2_subtext.innerText = data['globalData']['global-commentator-two-subtext'] ? data['globalData']['global-commentator-two-subtext'] : '';
        matchEventName.innerText = data['globalData']['global-event-name'] ? data['globalData']['global-event-name'] : '';
        matchEventFormat.innerText = data['globalData']['global-event-format'] ? data['globalData']['global-event-format'] : '';
        matchEventMiscDetails.innerText = data['globalData']['global-event-miscellaneous-details'] ? data['globalData']['global-event-miscellaneous-details'] : '';
        matchEventBaseLifePoints.innerText = data['globalData']['global-event-base-life-points'] ? data['globalData']['global-event-base-life-points'] : '20';
        matchEventBaseLifePointsCurrent.innerText = data['globalData']['global-event-base-life-points'] ? data['globalData']['global-event-base-life-points'] : '20';
        baseLifePoints = data['globalData']['global-event-base-life-points'] ? data['globalData']['global-event-base-life-points'] : '20';
        matchEventBaseTimer.innerText = data['globalData']['global-event-base-timer'] ? data['globalData']['global-event-base-timer'] : '50';
        matchEventBaseTimerCurrent.innerText = data['globalData']['global-event-base-timer'] ? data['globalData']['global-event-base-timer'] : '50';
        baseTimer = data['globalData']['global-event-base-timer'] ? data['globalData']['global-event-base-timer'] : '50';
    })

    // add click handlers for update event name and event format button
    function attachGlobalEventInformationUpdateListener() {
        updateEventInformation.addEventListener('click', () => {
            const data2send = {
                'global-event-name': matchEventName.innerText,
                'global-event-format': matchEventFormat.innerText,
                'global-event-miscellaneous-details': matchEventMiscDetails.innerText,
                'global-event-base-life-points': matchEventBaseLifePoints.innerText,
                'global-event-base-timer': matchEventBaseTimer.innerText
            }
            console.log(data2send)
            socket.emit('update-event-information-requested', {eventInformationData: data2send});
        })
    }

    // attach global event information update button listener on start up
    attachGlobalEventInformationUpdateListener();

    // START TIMER FUNCTIONS

    // at the start, ask for all timer states from the server
    socket.emit('get-all-timer-states');

    // handle getting all timer states
    socket.on('current-all-timer-states', ({timerState}) => {
        // save all timer states
        allTimerStates = timerState;
        // Iterate through all rounds and matches
        Object.keys(timerState).forEach((roundId) => {
            Object.keys(timerState[roundId]).forEach((matchId) => {
                const matchState = timerState[roundId][matchId];
                const timerElement = document.querySelector(`#timer-${roundId}-${matchId}`);
                if (timerElement) {
                    timerElement.innerText = matchState.time > 0 ? formatTime(matchState.time) : 'TURNS';
                }
                const timerShowCheck = document.querySelector(`#timer-display-scoreboard-${roundId}-${matchId}`);
                if (timerShowCheck) {
                    timerShowCheck.checked = matchState.show;
                }
            });
        });
    });

    function updateTimerState(round_id, match_id, action) {
        socket.emit('update-timer-state', {round_id, match_id, action});
    }

    function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000);
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
        const seconds = String(totalSeconds % 60).padStart(2, '0');
        return `${minutes}:${seconds}`;
    }

    // Add event listeners for reset life buttons
    function attachMatchTimerButtonListeners(round_id, match_id) {
        const startButton = document.querySelector(`#timer-start-${round_id}-${match_id}`);
        const addButton = document.querySelector(`#timer-add-${round_id}-${match_id}`);
        const minusButton = document.querySelector(`#timer-minus-${round_id}-${match_id}`);
        const pauseButton = document.querySelector(`#timer-pause-${round_id}-${match_id}`);
        const resetButton = document.querySelector(`#timer-reset-${round_id}-${match_id}`);
        const timerShowCheck = document.querySelector(`#timer-display-scoreboard-${round_id}-${match_id}`);
        startButton.addEventListener('click', () => {
            console.log('start clicked', round_id, match_id)
            updateTimerState(round_id, match_id, 'start');
        });
        addButton.addEventListener('click', () => {
            console.log('add clicked', round_id, match_id)
            updateTimerState(round_id, match_id, 'add');
        });
        minusButton.addEventListener('click', () => {
            console.log('minus clicked', round_id, match_id)
            updateTimerState(round_id, match_id, 'minus');
        });
        pauseButton.addEventListener('click', () => {
            console.log('pause clicked', round_id, match_id)
            updateTimerState(round_id, match_id, 'pause');
        });
        resetButton.addEventListener('click', () => {
            console.log('reset clicked', round_id, match_id)
            updateTimerState(round_id, match_id, 'reset');
        });
        timerShowCheck.addEventListener('change', function () {
            console.log('show / no show clicked', round_id, match_id, timerShowCheck.checked);
            if (timerShowCheck.checked) {
                updateTimerState(round_id, match_id, 'show');
            } else {
                updateTimerState(round_id, match_id, 'no-show');
            }
        });
    }

    // END TIMER FUNCTIONS

    // STANDINGS DATA

    socket.on('standings-data', ({standingsData}) => {
        console.log('got standings data', standingsData);
        allStandingsData = standingsData;
        // populate all standings text boxes per round
        populateStandingsData();
    })

    populateStandingsData = () => {
        Object.keys(allStandingsData).forEach((round_id) => {
            renderStandings(round_id);
        })
    }

    renderStandings = (roundId) => {
        // Check if a card for this match already exists
        let standingsContainer = document.getElementById(`round-${roundId}-matches`);
        let standingsCard = document.getElementById(`standings-card-${roundId}`);

        if (!standingsCard) {
            // make standings card
            // Create new card (use your existing card HTML structure)
            standingsCard = document.createElement('div');
            standingsCard.classList.add('col-6', 'mb-3', 'standings-card-container');
            standingsCard.id = `standings-card-${roundId}`;
            standingsCard.innerHTML = `
            <div class="card">
                <div class="card-body">
                    <div class="row mb-4">
                        <!-- Event Information -->
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">
                                    <h5 class="card-title">Standings</h5>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Round Standings</label>
                                        <textarea id="standings-${roundId}" class="editable form-control" rows="5"
                                        placeholder="Paste standings here..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
            // Add the new card to the round's match container
            standingsContainer.appendChild(standingsCard);
            // Attach change listeners
            attachStandingsChangeListeners(roundId);
        }

        // Update the fields with the match data
        const standingsTextbox = document.getElementById(`standings-${roundId}`);
        standingsTextbox.value = allStandingsData[roundId];
    }

    // Function to attach change listeners to all editable fields for a given match ID
    function attachStandingsChangeListeners(roundId) {
        const standingsTextbox = document.querySelector(`#standings-${roundId}.editable`);

        standingsTextbox.addEventListener('input', () => {
            let value = standingsTextbox.value;

            // Update the local standings data when a field changes
            updateStandingsData(roundId, value);
            // Emit the updated standings data to the backend
            console.log('updated standings data', allStandingsData);
            socket.emit('standings-updated', {round_id: roundId, textData: value});
        });
    }

    function updateStandingsData(roundId, value) {
        if (!allStandingsData[roundId]) {
            allStandingsData[roundId] = {};
        }
        console.log(roundId, value)
        allStandingsData[roundId] = value;
    }


    // END STANDINGS DATA

    // BRACKET DATA HANDLING

    // send request for bracket data - we can do this because the html for bracket is hardcoded at start
    socket.emit('get-bracket-data');

    socket.on('bracket-data', ({bracketData: bracketDataFromServer}) => {
        console.log('got bracket data', bracketDataFromServer);
        bracketData = bracketDataFromServer;
        // populate all standings text boxes per round
        populateBracketData();
    })

    populateBracketData = () => {
        Object.keys(bracketData).forEach((bracket_id) => {
            renderBracket(bracket_id);
        })
    }

    renderBracket = (bracket_id) => {
        let bracketField = document.getElementById(`${bracket_id}`);
        bracketField.innerHTML = bracketData[bracket_id];
    }

    // function to gather bracket data when update is clicked
    function attachBracketUpdateClickListener() {
        const bracketUpdateButton = document.querySelector(`#bracket-update-button`);

        bracketUpdateButton.addEventListener('click', () => {
            const bracketValues = extractBracketData();
            // send update to server to handle storage
            socket.emit('bracket-updated', {bracketValues});
        });
    }

    // actually call the attach button listener
    attachBracketUpdateClickListener();

    function extractBracketData() {
        // Select the parent container
        const bracketControl = document.querySelector('#bracket-control');

        // Select all child divs within the container with class 'editable' and IDs starting with 'bracket-'
        const bracketFields = bracketControl.querySelectorAll('[id^="bracket-"].editable');

        // Create a structure to hold the ID-value pairs
        const bracketValues = {};

        // Loop through each selected element
        bracketFields.forEach(div => {
            const id = div.id; // Get the id of the div
            // Get the content of the div (editable input)
            bracketValues[id] = div.textContent.trim(); // Add the id-value pair to the structure
        });
        return bracketValues
    }

    // END BRACKET DATA HANDLING

    // CARD LIST DATA HANDLING

    function renderDropdownListForCardView(dropdownList, cards, field) {
        dropdownList.innerHTML = '';
        cards.forEach(card => {
            const div = document.createElement('div');
            div.textContent = card;
            div.classList.add('dropdown-item');
            div.addEventListener('click', function () {
                field.textContent = card;
                dropdownList.style.display = 'none';
                field.dispatchEvent(new Event('input'));
                field.dispatchEvent(new Event('change')); // Trigger change event
            });
            dropdownList.appendChild(div);
        });
        dropdownList.style.display = cards.length > 0 ? 'block' : 'none';
    }

    function setupCardViewCustomDropdown() {
        const cardViewFields = document.querySelectorAll('[id="card-view-card-autocomplete"]');

        cardViewFields.forEach(field => {
            if (field.parentNode.classList.contains('custom-dropdown')) {
                return; // Skip if already set up
            }

            const wrapper = document.createElement('div');
            wrapper.className = 'custom-dropdown';
            field.parentNode.insertBefore(wrapper, field);
            wrapper.appendChild(field);

            const dropdownList = document.createElement('div');
            dropdownList.className = 'dropdown-list';
            wrapper.appendChild(dropdownList);

            field.addEventListener('input', function () {
                const value = this.textContent.trim().toLowerCase();

                // Only filter and render the list if input has 2 or more characters
                if (value.length >= 2) {
                    const filteredCardsList = cardListData.filter(card => card.toLowerCase().includes(value))
                        .slice(0, 5); // Limit to top 5 results
                    renderDropdownListForCardView(dropdownList, filteredCardsList, field);
                } else {
                    dropdownList.style.display = 'none'; // Hide dropdown if less than 2 characters
                }
            });

            field.addEventListener('focus', function () {
                const value = this.textContent.trim().toLowerCase();

                // Check the current input value and filter if it has 2 or more characters
                if (value.length >= 2) {
                    const filteredCardsList = cardListData.filter(card => card.toLowerCase().includes(value))
                        .slice(0, 5); // Limit to top 5 results
                    renderDropdownListForCardView(dropdownList, filteredCardsList, field);
                } else {
                    dropdownList.style.display = 'none'; // Hide dropdown if less than 2 characters
                }
            });

            document.addEventListener('click', function (e) {
                if (!wrapper.contains(e.target)) {
                    dropdownList.style.display = 'none';
                }
            });
        });
    }

    function attachCardViewViewCardClickListener() {
        cardViewViewCardButton.addEventListener('click', () => {
            const cardSelectInput = document.getElementById('card-view-card-autocomplete');
            const data2send = {
                'card-selected': cardSelectInput.innerText
            }
            console.log(data2send)
            socket.emit('card-view-view-card', {cardSelected: data2send});
        })
    }

    attachCardViewViewCardClickListener();

    // send request for card list data from server
    socket.emit('get-card-list-data');

    // handle receiving card list data from server
    socket.on('card-list-data', ({cardListData: cardListDataFromServer}) => {
        // console.log('got card list data from server', cardListDataFromServer);
        // save card list data
        cardListData = cardListDataFromServer;
        // setup dropdown and autocomplete for card view section
        setupCardViewCustomDropdown();
    })


    // END CARD LIST DATA HANDLING

</script>
</body>
</html>
